<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Make Matches</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .team-box {
      margin-bottom: 20px;
    }
    .team-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .player-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .player-button {
      padding: 10px 15px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      cursor: pointer;
    }
    .player-button.selected {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .save-button {
      background-color: #4caf50;
      color: white;
      border: none;
    }
    .cancel-button {
      background-color: #f44336;
      color: white;
      border: none;
    }
  </style>
</head>
<body>
  <div class="team-box">
    <div class="team-title">이긴 팀</div>
    <div id="winning-team" class="player-list"></div>
  </div>
  <div class="team-box">
    <div class="team-title">진 팀</div>
    <div id="losing-team" class="player-list"></div>
  </div>
  <div class="buttons">
    <button class="save-button" id="save-button">저장</button>
    <button class="cancel-button" id="cancel-button">취소</button>
  </div>

  <script>
    // GET 요청으로 선수 명단 가져오기
    async function loadPlayers() {
      try {
        const response = await fetch('/getMakeDay', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const dayPlayerList = await response.json().dayPlayerList;

        if (Array.isArray(dayPlayerList)) {
          populatePlayers('winning-team', dayPlayerList);
          populatePlayers('losing-team', dayPlayerList);
        }
      } catch (error) {
        console.error('Error loading players:', error);
      }
    }
    

    // 선수 명단을 버튼으로 생성
    function populatePlayers(containerId, players) {
      const container = document.getElementById(containerId);
      container.innerHTML = ''; // 초기화
      players.forEach(player => {
        const button = document.createElement('button');
        button.textContent = player;
        button.classList.add('player-button');
        button.onclick = () => button.classList.toggle('selected'); // 선택/해제
        container.appendChild(button);
      });
    }

    // 저장 버튼 클릭 이벤트
    document.getElementById('save-button').addEventListener('click', async () => {
      const winningPlayers = getSelectedPlayers('winning-team');
      const losingPlayers = getSelectedPlayers('losing-team');

      try {
        const response = await fetch('/makeMatches', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            winningPlayers,
            losingPlayers,
          }),
        });

        if (response.ok) {
          alert('저장되었습니다.');
          window.close();
        } else {
          alert('저장에 실패했습니다.');
        }
      } catch (error) {
        console.error('Error saving match results:', error);
      }
    });

    // 취소 버튼 클릭 이벤트
    document.getElementById('cancel-button').addEventListener('click', () => {
      window.close(); // 팝업창 닫기
    });

    // 선택된 선수 가져오기
    function getSelectedPlayers(containerId) {
      const container = document.getElementById(containerId);
      const selectedButtons = container.querySelectorAll('.player-button.selected');
      return Array.from(selectedButtons).map(button => button.textContent);
    }

    // 페이지 로드 시 선수 명단 로드
    document.addEventListener('DOMContentLoaded', loadPlayers);
  </script>
</body>
</html>
